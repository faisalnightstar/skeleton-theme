<!-- CarKit Trending Products Section -->
<section style="background: {{ section.settings.section_bg }}; padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;">
  <div style="max-width: 1280px; margin: 0 auto; padding: 0 24px;">

    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 32px;">
      <h2 style="font-size: {{ section.settings.heading_size }}px; font-weight: 900; color: {{ section.settings.heading_color }}; letter-spacing: -0.025em;">{{ section.settings.heading }}</h2>
      {% if section.settings.show_view_all and section.settings.view_all_url != blank %}
        <a href="{{ section.settings.view_all_url }}" style="display: inline-flex; align-items: center; gap: 4px; font-size: 14px; font-weight: 600; color: {{ section.settings.view_all_color }}; text-decoration: none;">
          {{ section.settings.view_all_text }}
          <span class="material-symbols-outlined" style="font-size: 18px;">arrow_forward</span>
        </a>
      {% endif %}
    </div>

    <div style="display: grid; grid-template-columns: repeat({{ section.settings.columns }}, 1fr); gap: {{ section.settings.gap }}px;">
      {% for block in section.blocks %}
        {% if block.type == 'product' %}
          {% assign product_ref = block.settings.product %}
          {% if product_ref != blank %}
            {% assign product_url = product_ref.url %}
            {% assign product_title = product_ref.title %}
            {% assign product_price = product_ref.price | money %}
            {% assign product_compare = product_ref.compare_at_price | money %}
          {% else %}
            {% assign product_url = block.settings.url | default: '#' %}
            {% assign product_title = block.settings.title %}
            {% assign product_price = block.settings.price %}
            {% assign product_compare = block.settings.compare_price %}
          {% endif %}
          <div {{ block.shopify_attributes }} class="trending-card" style="cursor: pointer;" onmouseover="this.querySelector('.quick-add') && (this.querySelector('.quick-add').style.transform='translateY(0)', this.querySelector('.quick-add').style.opacity='1'); this.querySelector('.product-img') && (this.querySelector('.product-img').style.transform='scale(1.05)')" onmouseout="this.querySelector('.quick-add') && (this.querySelector('.quick-add').style.transform='translateY(100%)', this.querySelector('.quick-add').style.opacity='0'); this.querySelector('.product-img') && (this.querySelector('.product-img').style.transform='scale(1)')">

            <div style="position: relative; aspect-ratio: 4/5; border-radius: {{ section.settings.card_radius }}px; overflow: hidden; background: #f1f5f9; margin-bottom: 14px;">
              {% if block.settings.image != blank %}
                {% assign product_img = block.settings.image %}
              {% elsif product_ref != blank %}
                {% assign product_img = product_ref.featured_image %}
              {% else %}
                {% assign product_img = nil %}
              {% endif %}
              {% if product_img %}
                <a href="{{ product_url }}">
                  <img class="product-img" src="{{ product_img | image_url: width: 600 }}" alt="{{ product_title | escape }}" width="600" height="750" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s;">
                </a>
              {% else %}
                <a href="{{ product_url }}" class="product-img" style="width: 100%; height: 100%; background: linear-gradient(135deg, #e2e8f0, #f1f5f9); display: flex; align-items: center; justify-content: center; text-decoration: none; color: #cbd5e1; transition: transform 0.3s;">
                  <span class="material-symbols-outlined" style="font-size: 48px;">image</span>
                </a>
              {% endif %}

              {% if block.settings.badge != blank %}
                <div style="position: absolute; top: 12px; left: 12px; padding: 4px 12px; border-radius: 9999px; font-size: 11px; font-weight: 700; letter-spacing: 0.05em; text-transform: uppercase;
                  {% if block.settings.badge_type == 'discount' %}background: {{ section.settings.badge_discount_bg | default: '#f43f5e' }}; color: #fff;{% else %}background: {{ section.settings.badge_trending_bg | default: 'rgba(255,255,255,0.9)' }}; color: {{ section.settings.badge_trending_color | default: '#111418' }};{% endif %}
                ">{{ block.settings.badge }}</div>
              {% endif %}

              {% if section.settings.show_quick_add %}
                <div class="quick-add" style="position: absolute; bottom: 0; left: 0; right: 0; padding: 12px; transform: translateY(100%); opacity: 0; transition: all 0.3s;">
                  <a href="{{ product_url }}" style="width: 100%; height: 44px; background: {{ section.settings.quick_add_bg | default: '#0d7ff2' }}; color: {{ section.settings.quick_add_color | default: '#fff' }}; font-size: 13px; font-weight: 600; border-radius: 10px; display: flex; align-items: center; justify-content: center; gap: 6px; text-decoration: none;">
                    <span class="material-symbols-outlined" style="font-size: 18px;">add_shopping_cart</span>
                    {{ section.settings.quick_add_text }}
                  </a>
                </div>
              {% endif %}
            </div>

            <a href="{{ product_url }}" style="text-decoration: none; color: inherit;">
              <h3 style="font-size: {{ section.settings.title_size }}px; font-weight: 700; color: {{ section.settings.title_color }}; margin-bottom: 6px;">{{ product_title }}</h3>
            </a>

            {% if section.settings.show_rating %}
              <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                <div style="display: flex; gap: 1px;">
                  {% assign stars = block.settings.rating | default: 5 %}
                  {% for i in (1..5) %}
                    <span class="material-symbols-outlined" style="font-size: 14px; color: {% if i <= stars %}{{ section.settings.star_color | default: '#f59e0b' }}{% else %}#e2e8f0{% endif %};">star</span>
                  {% endfor %}
                </div>
                {% if block.settings.review_count != blank %}
                  <span style="font-size: 12px; color: #94a3b8;">({{ block.settings.review_count }})</span>
                {% endif %}
              </div>
            {% endif %}

            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="font-size: {{ section.settings.price_size }}px; font-weight: 700; color: {{ section.settings.price_color }};">{{ product_price }}</span>
              {% if product_compare != blank and product_compare != product_price %}
                <span style="font-size: 14px; color: #94a3b8; text-decoration: line-through;">{{ product_compare }}</span>
              {% endif %}
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Trending Products",
  "settings": [
    { "type": "header", "content": "Section" },
    { "type": "color", "id": "section_bg", "label": "Background", "default": "#ffffff" },
    { "type": "range", "id": "padding_top", "label": "Top padding", "min": 32, "max": 96, "step": 8, "default": 64, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Bottom padding", "min": 32, "max": 96, "step": 8, "default": 64, "unit": "px" },
    { "type": "header", "content": "Heading" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Trending Now" },
    { "type": "range", "id": "heading_size", "label": "Heading size", "min": 20, "max": 48, "step": 2, "default": 30, "unit": "px" },
    { "type": "color", "id": "heading_color", "label": "Heading color", "default": "#111418" },
    { "type": "header", "content": "View All" },
    { "type": "checkbox", "id": "show_view_all", "label": "Show View All link", "default": true },
    { "type": "text", "id": "view_all_text", "label": "View All text", "default": "View All" },
    { "type": "url", "id": "view_all_url", "label": "View All URL" },
    { "type": "color", "id": "view_all_color", "label": "View All color", "default": "#0d7ff2" },
    { "type": "header", "content": "Grid" },
    { "type": "range", "id": "columns", "label": "Columns", "min": 2, "max": 6, "step": 1, "default": 4 },
    { "type": "range", "id": "gap", "label": "Gap between products", "min": 12, "max": 32, "step": 4, "default": 20, "unit": "px" },
    { "type": "header", "content": "Product cards" },
    { "type": "range", "id": "card_radius", "label": "Card border radius", "min": 0, "max": 24, "step": 2, "default": 12, "unit": "px" },
    { "type": "range", "id": "title_size", "label": "Title size", "min": 12, "max": 20, "step": 1, "default": 15, "unit": "px" },
    { "type": "color", "id": "title_color", "label": "Title color", "default": "#111418" },
    { "type": "range", "id": "price_size", "label": "Price size", "min": 12, "max": 24, "step": 2, "default": 16, "unit": "px" },
    { "type": "color", "id": "price_color", "label": "Price color", "default": "#111418" },
    { "type": "header", "content": "Rating" },
    { "type": "checkbox", "id": "show_rating", "label": "Show star rating", "default": true },
    { "type": "color", "id": "star_color", "label": "Star color", "default": "#f59e0b" },
    { "type": "header", "content": "Quick Add" },
    { "type": "checkbox", "id": "show_quick_add", "label": "Show Quick Add button on hover", "default": true },
    { "type": "text", "id": "quick_add_text", "label": "Quick Add button text", "default": "Quick Add" },
    { "type": "color", "id": "quick_add_bg", "label": "Quick Add background", "default": "#0d7ff2" },
    { "type": "color", "id": "quick_add_color", "label": "Quick Add text color", "default": "#ffffff" },
    { "type": "header", "content": "Badges" },
    { "type": "color", "id": "badge_trending_bg", "label": "Trending badge background", "default": "rgba(255,255,255,0.9)" },
    { "type": "color", "id": "badge_trending_color", "label": "Trending badge text", "default": "#111418" },
    { "type": "color", "id": "badge_discount_bg", "label": "Discount badge background", "default": "#f43f5e" }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "product", "id": "product", "label": "Product", "info": "Links and prices auto-fill. Or use manual fields below." },
        { "type": "text", "id": "title", "label": "Title", "default": "Product Name" },
        { "type": "text", "id": "price", "label": "Price", "default": "$99.99" },
        { "type": "text", "id": "compare_price", "label": "Compare at price" },
        { "type": "url", "id": "url", "label": "Product URL" },
        { "type": "text", "id": "badge", "label": "Badge text" },
        { "type": "select", "id": "badge_type", "label": "Badge type", "options": [
          { "value": "trending", "label": "Trending" },
          { "value": "discount", "label": "Discount" }
        ], "default": "trending" },
        { "type": "range", "id": "rating", "label": "Rating", "min": 1, "max": 5, "step": 1, "default": 5 },
        { "type": "text", "id": "review_count", "label": "Review count", "default": "10k reviews" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Trending Products",
      "blocks": [
        { "type": "product", "settings": { "title": "Dashcam Pro 4K AI", "price": "$149.00", "badge": "TRENDING", "badge_type": "trending", "rating": 5, "review_count": "10k reviews" } },
        { "type": "product", "settings": { "title": "All-Weather Floor Mats", "price": "$89.99", "badge": "TRENDING", "badge_type": "trending", "rating": 5, "review_count": "10k reviews" } },
        { "type": "product", "settings": { "title": "Xenon LED Headlight Kit", "price": "$59.49", "compare_price": "$69.00", "badge": "-10%", "badge_type": "discount", "rating": 5, "review_count": "8k reviews" } },
        { "type": "product", "settings": { "title": "Digital Tire Inflator", "price": "$45.00", "rating": 5, "review_count": "5k reviews" } }
      ]
    }
  ]
}
{% endschema %}
